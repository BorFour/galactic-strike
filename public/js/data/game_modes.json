
var quitGameGM = function () {
    window.close();
}

var gameModes =
{
    'deathmatch' : {
        'name' : 'deathmatch',
        'init' : function () {

             this.scores = []
             for (var t in this.room.teams)
             {
                this.scores[t] = 0;
             }

        },
        'startRound' : function () {

            //this.stage.load();
            for (var i = 0; i < this.room.teams.length; i++)
            {
                for (var j = 0; j < this.room.teams[i].players.length; j++)
                {
                    //this.room.teams[i].players[j].spawn();
                }
            }

        },
        'winnerRound' : function (){

            var teams_alive = 0;
            var winner = null;
            for(var i = 0; i < this.room.teams.length; i++)
            {
                if(this.room.teams[i].alive())
                {
                    ++teams_alive;
                    winner = this.room.teams[i];
                }
                //console.log(this.room.teams[i].name + ' ' + this.room.teams[i].alive())

            }

            return (teams_alive === 1 ? winner : null);

        },
        'winner' : function (){

            var maxScore = Number.MIN_VALUE;
            var maxTeams = null;
            for (var t in this.teams){
                if(this.scores[t] === maxScore){
                    maxTeams.push(this.teams[t]);
                }
                else if (this.scores[t] > maxScore){
                    maxScore = this.scores[t];
                    maxTeams = [].push(this.teams[t]);
                }
            }

            return maxTeams;

        },
        'isOverGame' : function (){

                return true;
 //           return this.scores.some(function(element, index, array){
 //               return element >= this.winScore;
 //           });

        },
        'winScore' : 1,
        'showWinner' : function (winner) {

        var nameLabel = game.add.text(game.world.centerX, - 80, (winner + ' wins!'),{ font: '70px Geo   ', fill: '#ffffff' });
        nameLabel.anchor.setTo(0.5, 0.5);
        var buttonQuit = game.add.button(game.world.centerX, game.world.centerY , 'exitButton', quitGameGM, this, 0, 0, 0, 0);

        buttonQuit.anchor.set(0.5);
        buttonQuit.scale.set(0.25);

        game.camera.follow(null);
        var toButton = game.add.tween(game.camera).to({x : buttonQuit.x  - game.camera.width/2, y : buttonQuit.y - game.camera.height/2}, 350, Phaser.Easing.Quadratic.InOut, true);

        game.time.events.add(10000, quitGameGM, this);

        game.add.tween(nameLabel).to({y: game.world.centerY - 90}, 1000).easing(Phaser.Easing.Bounce.Out).start();
        toButton.start();


        },
        'update' : function (){

            var wr = this.winnerRound();
            if(wr)
            {
                this.scores[wr] += 1;
                console.log(wr.name + ' won this round.' + this.scores[wr] + ' points');
                if(this.isOverGame())
                {
                    console.log('Showing winner');
                    this.showWinner(wr);
                    return true;
                }
                else
                {
                    this.startRound();
                }
            }

            return false;

        }
    }

}
